
%!TEX ROOT=ctutest.tex

\chapter{Dynamický model}

Pro výpočet a predikci spotřeby elektrické energie robotického manipulátoru je nezbytné vytvořit matematický model robotu popisující jeho dynamiku.

Robot KUKA KR5 Arc je mechanický systém tvořený šesti sériově spojenými rameny. Každé rameno se může nezávisle na ostatních otáčet kolem své vlastní osy rotace. Okamžitou konfiguraci ramen robotu i pozici koncového efektoru v prostoru je tak možné popsat šesti souřadnicemi odpovídajícími úhlům natočení jednotlivých os. Jedná se tak o systém se šesti stupni volnosti. K popisu jeho dynamiky je proto potřeba celkem 6 diferenciálních rovnic druhého řádu. Celkově se tedy jedná o dynamický systém 12. řádu. 

\section{Pohybové rovnice}
\label{pohybove_rovnice_sec}
K odvození pohybových rovnic je možné použít jeden ze dvou základních přístupů a to Newton-Eulerovu metodu nebo Euler-Lagrangeovu metodu \cite{rob_mod_control}. 

Newton-Eulerova metoda je založena na přístupu k systému jako k soustavě jednotlivých jeho součástí a vyžaduje určení pohybových rovnic každé jednotlivé komponenty. Výsledná dynamika je poté součtem dynamik všech dílčích komponent systému. Protože jsou jednotlivé osy sériových robotických manipulátorů vzájemně kinematicky propojeny, jsou i pohybové rovnice jednotlivých jejich os závislé na pohybu ostatních os. 

Euler-Lagrangeova metoda naopak přistupuje k systému jako k celku a je založena na určení Lagrangianu, který je definován jako rozdíl celkové kinetické a potenciální energie systému. Dynamické rovnice systému je poté možné odvodit vypočtením Lagrangeových rovnic druhého druhu pro všechny stupně volnosti systému.

Oba přístupy nakonec vedou ke stejným rovnicím. Protože jsou pohyb a dynamika systému popisovány pomocí úhlů a jejich derivací na jednotlivých osách, vyskytují se v jejich rovnicích nelineární goniometrické členy. Výsledné rovnice systému jsou proto silně nelineární. Pro zlepšení přehlednosti rovnic systému je možné tyto rovnice zapsat v následujícím maticovém tvaru jako 

\begin{equation}
\vect{T} = \mathbb{M}(\vect{\dot{\theta}},\vect{\theta})\vect{\ddot{\theta}} + \mathbb{C}(\vect{\dot{\theta}},\vect{\theta})\vect{\dot{\theta}} + \mathbb{G}(\vect{\theta}),
\label{dyn_rovnice_eq}
\end{equation}

kde

\begin{description}
\item[$\vect{T} = {\big[T_1, T_2,  \dotsm  T_n\big]}^{T}$] je vektor momentů sil působících na jednotlivé osy robotu,
\item[$\vect{\theta} = {\big[\theta_1, \theta_2, \dotsm \theta_n\big]}^{T}$] je vektor úhlů na jednotlivých osách,
\item[$\vect{\dot\theta} = {\big[\dot \theta_1, \dot \theta_2,  \dotsm  \dot \theta_n\big]}^{T}$] je vektor úhlových rychlostí na jednotlivých osách,
\item[$\vect{\ddot\theta} = {\big[\ddot \theta_1, \ddot \theta_2,  \dotsm  \ddot \theta_n\big]}^{T}$] je vektor úhlových zrychlení na jednotlivých osách,
\item[$\mathbb{M}\big(\vect{\dot\theta}, \vect{\theta}\big)$] je matice setrvačnosti tvořena tenzory setrvačnosti jednotlivých os,
\item[$\mathbb{C}\big(\vect{\dot\theta}, \vect{\theta}\big)$] je matice Coriolisových a odstředivých momentů sil působících na jednotlivé osy,
\item[$\mathbb{G}\big(\vect{\theta}\big)$] je matice gravitačních sil působících na jednotlivé osy,
\item[$n$] je počet os.
\end{description}

K výpočtu okamžité spotřeby elektrické energie je nutné řešit inverzní dynamickou úlohu (viz rovnice \eqref{dyn_rovnice_eq}), kdy se z okamžitých poloh, úhlových rychlostí a úhlových zrychlení na jednotlivých osách robota vypočítají točivé momenty, kterými na osy působí motory. 

Moment síly motoru je závislý na proudu protékajícím jeho vinutím. Tuto závislost je obvykle možné aproximovat lineární závislostí \cite{sbornik} a psát jako
\begin{equation}
T\big(t\big) = KI\big(t\big),
\label{torque_current_eq}
\end{equation}

kde

\begin{description}
\item[$T\big(t\big) {\big[Nm\big]}$] je moment síly motoru, 
\item[$K {\big[Nm/A\big]}$] je momentová konstanta, 
\item[$I\big(t\big) {\big[A\big]}$] je proud protékající motorem. 
\end{description}

Nástroj TRACE robotu KUKA KR5 Arc tímto způsobem počítá točivé momenty jednotlivých motorů. Momentové konstanty jednotlivých motorů jsou obvykle poskytovány výrobci a je možné je dohledat v jejich dokumentaci \cite{motor1}\cite{motor2}\cite{motor3}. 

\section{Tření}

Odvozené rovnice dynamiky robota popsané výše v sekci \ref{pohybove_rovnice_sec} popisují pouze ideální model, ve kterém nedochází k žádným energetickým ztrátám. V reálných motorech ale kromě elektrických ztrát v jejich vinutích dochází také k energetickým ztrátám v důsledku tření v ložiscích motorů, rotačních os a tření v převodovkách.

Úplný popis tření v rotačních systémech je relativně komplikovaný, protože se jedná o silně nelineární děj, který navíc obecně bývá závislý na čase a na okolních podmínkách. Proto je výhodné použít zjednodušený model popisující tření jako kombinaci viskózního a Coulombova tření \cite{fric_eff_analysis}, který značně zjednodušuje popis systému. 

Viskózní tření motoru je moment síly působící proti otáčení motoru, který je lineárně závislý na jeho rychlosti rotace. Při nulové rychlosti je třecí moment síly nulový a s rostoucí rychlostí se zvyšuje. Při změně směru otáčení motoru se mění i směr působení třecího momentu. 

Coulombovo tření je naopak na rychlosti rotace nezávislé. V systému je přítomno vždy a vždy se stejnou magnitudou. Mění se pouze se změnou směru otáčení, kdy mění znaménko.

Tento použitý popis tření je popsán rovnicí 

\begin{equation}
T_f = f_v\dot{\theta} + f_csign(\dot{\theta}),
\label{fric_eq}
\end{equation}

kde

\begin{description}
\item[$T_f$] je moment síly generovaný třením, 
\item[$f_v$] je koeficient viskózního tření, 
\item[$f_c$] je koeficient Coulombova tření. 
\end{description}

Na následujícím obrázku (obr. \ref{treni_pic}) je znázorněn použitý model tření včetně jeho jednotlivých složek. Na vodorovné ose je uvedena úhlová rychlost otáčení, na svislé ose je generovaný třecí moment síly.

\newpage
\begin{figure}[ht]
\includegraphics[width=0.65\textwidth]{treni}
\caption{Model tření na osách robotu}
\label{treni_pic}
\end{figure}

Doplněním rovnic tření \eqref{fric_eq} do dynamických rovnic robotu \eqref{dyn_rovnice_eq} jsou odvozeny celkové rovnice dynamiky robotu ve tvaru

\begin{equation}
\vect{T_r} = \mathbb{M}(\vect{\dot{\theta}},\vect{\theta})\vect{\ddot{\theta}} + \mathbb{C}(\vect{\dot{\theta}},\vect{\theta})\vect{\dot{\theta}} + \mathbb{G}(\vect{\theta)} + \vect{F_v}\vect{\dot{\theta}} + \vect{F_c}sign(\vect{\dot{\theta}}),
\label{celkova_dyn_rovnice_eq}
\end{equation}

kde

\begin{description}
\item[$\vect{T_r} = {\big[T_{r1}, T_{r2},  \dotsm  T_{rn}\big]}^{T}$] je vektor celkových momentů sil působících na jednotlivé osy robotu,
\item[$\vect{F_v} = {\big[F_{v1}, F_{v2},  \dotsm  F_{vn}\big]}^{T}$] je vektor koeficientů viskózního tření v jednotlivých osách,
\item[$\vect{F_c} = {\big[F_{c1}, F_{c2},  \dotsm  F_{cn}\big]}^{T}$] je vektor koeficientů Coulombova tření v jednotlivých osách.
\end{description}

\section{Elektrický výkon a spotřeba elektrické energie}
\label{el_vykon_ch}
Výkon je obecně definován jako práce $W$ vykonaná za jednotku času \cite{zemanek}. Pro okamžitý výkon platí rovnice

\begin{equation}
p(t) = \frac{dW}{dt}.
\end{equation}

Protože se v tomto případě jedná o elektrickou práci, resp. práci elektromagnetického pole, je tato práce definovaná jako element náboje $dq$ přenesený mezi dvěma místy s napětím $u$. Po jejím dosazení platí vztah

\begin{equation}
p(t) = \frac{u(t)dq}{dt}.
\end{equation}

Protože element náboje $dq$ přenesený za čas $dt$ odpovídá okamžitému proudu, je možné vzorec pro okamžitý výkon upravit na

\begin{equation}
p(t) = u(t)\frac{dq}{dt} = u(t)i(t).
\end{equation}

Střední spotřebovaná elektrická energie je definovaná jako celková elektrická práce, která byla vykonaná spotřebičem za daný čas $t$. Platí pro ni vztah

\begin{equation}
W = Pt.
\end{equation}

Pro její okamžitou hodnotu lze tento vzorec upravit následovně

\begin{equation}
\frac{dW}{dt} = p(t).
\end{equation}  

Při zanedbání energetických ztrát v mechanické a elektrické části robotického systému a zanedbání vlivu napájení jeho elektronických součástí je možné očekávat rovnost mechanického výkonu s elektrickým výkonem.

\subsection{Elektrický výkon v třífázové soustavě}

Celý robotický systém je napájen z třífázové sítě. Třífázová soustava napájení je tvořena třemi fázovými vodiči a jedním centrálním nulovým vodičem. Na všech třech fázových vodičích je střídavé napětí se stejnou efektivní hodnotou. Každá ze tří fází má průběh napětí proti sousedním fázím fázově posunut o $120$ stupňů. 

V třífázových sítích jsou na jednotlivých fázích střídavá napětí a proudy. Jejich průběh je popisován harmonickou funkcí. Pro okamžité hodnoty střídavého napětí a proudu platí rovnice

\begin{equation}
\begin{split}
u\big(t\big) = U_m cos\big(\omega t + \phi\big), \\
i\big(t\big) = I_m cos\big(\omega t + \phi + \psi\big),
\end{split}
\label{harm_curr_volt_eq}
\end{equation}  
kde
\begin{description}
\item[$U_m$] je maximální amplituda napětí,
\item[$I_m$] je maximální amplituda proudu,
\item[$\omega$] je úhlová frekvence,
\item[$\phi$] je počáteční fáze proudu a napětí,
\item[$\psi$] je fázový posun mezi napětím a proudem.
\end{description}

Pokud je fázový posun $\psi$ mezi střídavým napětím a proudem nenulový, například v důsledku induktivního nebo kapacitního charakteru zátěže, je potřeba rozdělit elektrický výkon na jeho činnou a jalovou složku. 

Činná složka výkonu $P$ je výkon, který je přenášen ze zdroje do spotřebiče a který je schopen ve spotřebiči konat užitečnou práci. Pro střední hodnotu činné složky výkonu platí následující vztah

\begin{equation}
P = \frac{1}{T} \int_{t_0}^{t_0 + T} u(t)i(t)dt = UIcos(\phi),
\label{act_power_eq}
\end{equation}  

kde $U$ je efektivní hodnota napětí a $I$ je efektivní hodnota proudu.

Jalová složka výkonu $Q$ je část výkonu, která je spotřebičem vracená zpět do zdroje a ve spotřebiči tedy žádnou práci nevykonává.

Pro potřeby modelování spotřeby elektrické energie robotu je důležité určit právě činnou složku výkonu, protože je to ta část výkonu, která je využita k funkci robotu a jeho pohybu. 

V případě třífázové soustavy je její celkový činný výkon roven součtu činných výkonů na všech třech jednotlivých fázích. Platí tedy

\begin{equation}
p(t) = p_U(t) + p_V(t) + p_W(t),
\label{3ph_power_eq}
\end{equation}  

kde $U,V,W$ jsou jednotlivé fáze v třífázové soustavě.

\subsection{Elektrický výkon robotu}

Celkový elektrický výkon robotického manipulátoru je závislý na elektrickém výkonu jednotlivých jeho součástí. Elektrická část robotu je tvořena pohony ramen robotu, senzory poloh, teplot a dalších veličin a jeho centrální řídicí jednotkou. 

Je možné předpokládat, že spotřebovaný výkon jednotlivých senzorů a hlavní řídicí jednotky bude přibližně konstantní, protože musí pracovat stejně ze všech podmínek. Tato složka výkonu $P_s$ bude přispívat k celkovému výkonu robotického systému, nebude ale závislá na jeho dynamice. Celkový výkon robotu bude tedy tvořen touto stálou složkou $P_s$ a elektrickým výkonem pohonů robotu.
\newpage
Celkový okamžitý elektrický výkon při pohybu robotu je poté dán jako součet okamžitých výkonů na jeho jednotlivých motorech a stálé složky výkonu $P_s$.
\begin{equation}
P(t) = \sum_{i=1}^{n} p_i(t) + P_s,
\label{robot_motor_power_eq}
\end{equation} 
kde $n$ je počet motorů.

Osy robotu jsou poháněny elektrickými synchronními servomotory s permanentními magnety. K výpočtu výkonu elektrických motorů je potřeba vytvořit model jejich vinutí. Řídicí systém robotu KUKA KR5 Arc poskytuje pouze informace o celkovém efektivím proudu motoru. Z tohoto důvodu je možné synchronní motory s permanentními magnety zjednodušeně modelovat jako stejnosměrné (DC) motory [\cite{sbornik}] tvořené odporem a indukčností v sérii. Elektrické schéma stejnosměrného motoru na obrázku \ref{schema_motoru_pic}.  

\begin{figure}[ht]
\includegraphics[width=0.55\textwidth]{obvod_motoru}
\caption{Elektrické schéma vinutí synchronního motoru.}
\label{schema_motoru_pic}
\end{figure}

$R$ je vnitřní elektrický odpor vinutí a $L$ je jeho indukčnost. Tyto hodnoty jsou zpravidla udávány v dokumentaci k motorům.

Pro okamžité napětí $u(t)$ ze schématu platí vztah

\begin{equation}
u(t) = i(t)R + L\frac{di(t)}{dt}.
\label{motor_voltage_eq}
\end{equation}  

Okamžitý elektrický výkon motoru je poté možné z měření okamžité efektivní hodnoty proudu vypočítat jako
 
\begin{equation}
p(t) = i(t)u(t) = i(t)\left(i(t)R + L\frac{di(t)}{dt}\right).
\label{motor_power_eq}
\end{equation} 

\newpage
\section{Solver ReDySim}

Pro usnadnění odvození soustavy rovnic pro robota o 6 stupních volnosti a pro případnou standardizaci metody pro použití i pro jiné typy robotů byl použit skript pro matematický nástroj MATLAB využívající solver Recursive Dynamic Simulator (ReDySim) \cite{redysim}. Tento nástroj byl vyvinut na Indickém technologickém institutu v Dillí a je bezplatně k dispozici ke stažení a použití v MATLABu. K dispozici je bez zdrojových kódů. Je schopen generovat pohybové dynamické rovnice robotu s libovolným počtem os a to jak pro rotační, tak lineární osy. 

Vstupními parametry solveru ReDySim jsou modifikované DH (Denavit-Hartenbergovy) parametry robotu a dynamické parametry s numerickými nebo symbolickými hodnotami. Výstupem je poté funkce pro MATLAB s vygenerovanými pohybovými rovnicemi zadaného robotu.  

\section{Modifikované DH parametry robotu}

Modifikované Denavit-Hartenbergovy (DH) parametry jsou parametry, pomocí nichž je možné kompletně popsat geometrii a kinematiku sériového robotu. Jedná se o čtyři parametry pro každou osu robotu, které definují vzájemnou polohu a konfiguraci sousedících os. 

Parametr $a_i [m]$ popisuje délku ramena $i$, $b_i [m]$ udává odsazení ramena $i$ podél osy rotace ramena $i-1$, parametr $\alpha_i [\si{\degree}]$ určuje vzájemný úhel natočení mezi osou $i+1$ a osou $i$ a poslední parametr $\theta_i [\si{\degree}]$ udává okamžitý úhel natočení osy $i$.

V tabulce \ref{tab_DH_kuka} je DH parametrizace robotu KUKA KR5 Arc použita v nástroji ReDySim pro vygenerování jeho dynamických rovnic.

\begin{table}[htbp]
  \centering
  \caption{Tabulka DH parametrů KUKA KR5 Arc.}
    \begin{tabular}{c|cccccccccc}
    \multicolumn{1}{c|}{Osa} & \multicolumn{1}{c}{$a_{i} [m]$} & \multicolumn{1}{c}{$b_{i} [m]$} & \multicolumn{1}{c}{$\alpha_{i} [\si{\degree}]$} \\
    \hline
    1     &   0.18  &  0.4   &  90     &     \\
    2     &   0.6   &  0     &  180    &     \\
    3     &   0.12  &  0     &  -90    &     \\
    4     &   0     &  0.62  &  -90    &     \\
    5     &   0     &  0     &  90     &     \\
    6     &   0     &  0.115 &  0      &     \\
    \end{tabular}%
  \label{tab_DH_kuka}%
\end{table}% 

Přesné délky jednotlivých ramen a vzájemné polohy jednotlivých os robotu je možné nalézt v jeho dokumentaci.

Pro vizualizaci DH parametrizace je možné použít nástroj RoboAnalyzer \cite{roboanalyzer}. Tento nástroj byl vyvinut stejným týmem, jako solver ReDySim, na univerzitě v Dillí pro účely vizualizace a simulace. RoboAnalyzer umožňuje simulovat dopředné a zpětné kinematické a dynamické úlohy. Dále umožňuje simulovat jednoduché pohyby robotu s až 7 osami a vykreslovat průběhy jeho stavů jako jsou polohy, úhlové rychlosti, úhlová zrychlení a momenty sil na jednotlivých osách. Vizualizace použité DH parametrizace pro robota KUKA KR5 Arc v prostředí RoboAnalyzer je na obrázku \ref{dh_kuka_pic}.
\\
\begin{figure}[ht]
\includegraphics[width=0.95\textwidth]{pic_dh_kuka}
\caption{Vizualizace DH parametrizace robota KUKA KR5 Arc.}
\label{dh_kuka_pic}
\end{figure}

